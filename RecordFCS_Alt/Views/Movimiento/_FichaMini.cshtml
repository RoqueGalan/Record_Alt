@model RecordFCS_Alt.Models.ViewsModel.itemPiezaMini
@using RecordFCS_Alt.Helpers

@{
    bool esPrincipal = Model.esPrincipal;
    string classModal = "ModalImagen_" + Model.PiezaID;
    string textSinImagen = ViewBag.textSinImagen;
    string classTamano = ViewBag.classTamano;
    string classContenedor = Model.esPrincipal ? "pm-contenedorObra" : "pm-contenedorPieza";
}


<li class="media @classContenedor">

    <div class="media-left">


        @if (Model.esPrincipal && User.IsInRole("verFichComp"))
        {
            <a href="@Url.Action("Detalles", "Obra", new  {id = Model.ObraID })" class="btn btn-primary btn-xs" data-toggle="tooltip" title="Abrir Ficha Completa de Obra" target="_blank">@Model.FolioObra</a>
        }
        
        <div class="text-center">
            <h4>
                @Model.FolioPieza
            </h4>
        </div>

        <div class="center-block">

            @if (Model.ImagenID == null)
            {

                <img src="holder.js/@(textSinImagen)/text:404" alt="Sin Imagen" class="media-object @classTamano">
            }
            else
            {
                <a href="@Url.Action("Detalles", "ImagenPieza", new { id = Model.ImagenID})" data-modal="" class="LG@(classModal)">
                    <img src="@(Model.RutaImagenMini)" alt="@Model.FolioPieza" class="media-object @classTamano">
                </a>
            }
        </div>



    </div>


    <div class="media-body media-middle clearfix">

        <div>
            <div class="pull-right">
                @Html.NoEncodeActionLink("<span class='fa fa-plus'></span>", "Agregar Pieza", "AddPieza", "Movimiento", routeValues: new { id = Model.PiezaID, todas = false }, htmlAttributes: new { data_toggle = "tooltip", @class = "btn btn-primary btn-xs" })

                @if (Model.ListaPiezasHijas.Count > 0)
                {
                    @Html.NoEncodeActionLink("<span class='fa fa-plus'></span>", "Agregar Pieza", "AddPieza", "Movimiento", routeValues: new { id = Model.PiezaID, todas = true }, htmlAttributes: new { data_toggle = "tooltip", @class = "btn btn-primary btn-xs" })
                }

            </div>

        </div>

        <table class="table pm-table">
            <tr class="pm-table">
                <td class="col-lg-3 col-md-5 col-sm-5 pm-table">
                    <b>Tipo de Pieza</b>
                </td>

                <td class="pm-table">
                    @(Model.NombrePieza)
                </td>
            </tr>

            @foreach (var att in Model.Atributos)
            {
                <tr class="pm-table">
                    <td class="pm-table">
                        <b>@att.Nombre</b>
                    </td>

                    <td class="pm-table">
                        @foreach (var valor in att.Valores)
                        {
                            @valor.Valor
                            @*<span class="center-block">
                                    @valor.Valor
                                </span>*@
                        }
                    </td>
                </tr>
            }

        </table>

        @if (Model.ListaPiezasHijas.Count > 0)
        {
            <ul class="media-list">

                @foreach (var piezaHijaID in Model.ListaPiezasHijas)
                {
                    Html.RenderAction("FichaMini", "Movimiento", new { id = piezaHijaID, tipo = "guion", listaNombre = "x" });
                }

            </ul>
        }
    </div>


</li>




<script src="~/Scripts/holder.js"></script>

<script src="~/Scripts/add.toolTip.js"></script>


<script type="text/javascript">

    $(function () {
        $.ajaxSetup({ cache: false });

        // Abrir Modales en formulario PRE REGISTRO
        $("a[data-modal].LG@(classModal)").on("click", function (e) {
            $('#miModalContenidoLG').load(this.href, function () {
                $('#miModalLG').modal({
                    backdrop: 'static',
                    keyboard: true
                }, 'show');
            });
            return false;
        });
    });

</script>


<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>